var $e5ecc15f02f30365a22dc5943$exports = {};
$parcel$require("1154866e5ecc15f02f30365a22dc5943", "./map");

var $e5ecc15f02f30365a22dc5943$export$default = function () {
  var keys = [],
      sortKeys = [],
      sortValues,
      rollup,
      nest;

  function apply(array, depth, createResult, setResult) {
    if (depth >= keys.length) {
      if (sortValues != null) array.sort(sortValues);
      return rollup != null ? rollup(array) : array;
    }

    var i = -1,
        n = array.length,
        key = keys[depth++],
        keyValue,
        value,
        valuesByKey = $e5ecc15f02f30365a22dc5943$import$map(),
        values,
        result = createResult();

    while (++i < n) {
      if (values = valuesByKey.get(keyValue = key(value = array[i]) + "")) {
        values.push(value);
      } else {
        valuesByKey.set(keyValue, [value]);
      }
    }

    valuesByKey.each(function (values, key) {
      setResult(result, key, apply(values, depth, createResult, setResult));
    });
    return result;
  }

  function entries(map, depth) {
    if (++depth > keys.length) return map;
    var array,
        sortKey = sortKeys[depth - 1];
    if (rollup != null && depth >= keys.length) array = map.entries();else array = [], map.each(function (v, k) {
      array.push({
        key: k,
        values: entries(v, depth)
      });
    });
    return sortKey != null ? array.sort(function (a, b) {
      return sortKey(a.key, b.key);
    }) : array;
  }

  return nest = {
    object: function (array) {
      return apply(array, 0, $e5ecc15f02f30365a22dc5943$var$createObject, $e5ecc15f02f30365a22dc5943$var$setObject);
    },
    map: function (array) {
      return apply(array, 0, $e5ecc15f02f30365a22dc5943$var$createMap, $e5ecc15f02f30365a22dc5943$var$setMap);
    },
    entries: function (array) {
      return entries(apply(array, 0, $e5ecc15f02f30365a22dc5943$var$createMap, $e5ecc15f02f30365a22dc5943$var$setMap), 0);
    },
    key: function (d) {
      keys.push(d);
      return nest;
    },
    sortKeys: function (order) {
      sortKeys[keys.length - 1] = order;
      return nest;
    },
    sortValues: function (order) {
      sortValues = order;
      return nest;
    },
    rollup: function (f) {
      rollup = f;
      return nest;
    }
  };
};

$e5ecc15f02f30365a22dc5943$exports.default = $e5ecc15f02f30365a22dc5943$export$default;

function $e5ecc15f02f30365a22dc5943$var$createObject() {
  return {};
}

function $e5ecc15f02f30365a22dc5943$var$setObject(object, key, value) {
  object[key] = value;
}

function $e5ecc15f02f30365a22dc5943$var$createMap() {
  return $e5ecc15f02f30365a22dc5943$import$map();
}

function $e5ecc15f02f30365a22dc5943$var$setMap(map, key, value) {
  map.set(key, value);
}