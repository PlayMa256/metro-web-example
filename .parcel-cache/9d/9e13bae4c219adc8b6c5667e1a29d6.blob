var $a1bd9a7fd5616071822dbc2f8a$exports = {};
$parcel$require("045865a1bd9a7fd5616071822dbc2f8a", "@babel/runtime/helpers/esm/objectWithoutProperties");
$parcel$require("045865a1bd9a7fd5616071822dbc2f8a", "@babel/runtime/helpers/esm/extends");
$parcel$require("045865a1bd9a7fd5616071822dbc2f8a", "react");
$parcel$require("045865a1bd9a7fd5616071822dbc2f8a", "jss");
$parcel$require("045865a1bd9a7fd5616071822dbc2f8a", "../mergeClasses");
$parcel$require("045865a1bd9a7fd5616071822dbc2f8a", "./multiKeyStore");
$parcel$require("045865a1bd9a7fd5616071822dbc2f8a", "../useTheme");
$parcel$require("045865a1bd9a7fd5616071822dbc2f8a", "../StylesProvider");
$parcel$require("045865a1bd9a7fd5616071822dbc2f8a", "./indexCounter");
$parcel$require("045865a1bd9a7fd5616071822dbc2f8a", "../getStylesCreator");
$parcel$require("045865a1bd9a7fd5616071822dbc2f8a", "../getStylesCreator/noopTheme");

function $a1bd9a7fd5616071822dbc2f8a$var$getClasses(_ref, classes, Component) {
  var state = _ref.state,
      stylesOptions = _ref.stylesOptions;

  if (stylesOptions.disableGeneration) {
    return classes || {};
  }

  if (!state.cacheClasses) {
    state.cacheClasses = {
      // Cache for the finalized classes value.
      value: null,
      // Cache for the last used classes prop pointer.
      lastProp: null,
      // Cache for the last used rendered classes pointer.
      lastJSS: {}
    };
  } // Tracks if either the rendered classes or classes prop has changed,
  // requiring the generation of a new finalized classes object.


  var generate = false;

  if (state.classes !== state.cacheClasses.lastJSS) {
    state.cacheClasses.lastJSS = state.classes;
    generate = true;
  }

  if (classes !== state.cacheClasses.lastProp) {
    state.cacheClasses.lastProp = classes;
    generate = true;
  }

  if (generate) {
    state.cacheClasses.value = $a1bd9a7fd5616071822dbc2f8a$import$mergeClasses({
      baseClasses: state.cacheClasses.lastJSS,
      newClasses: classes,
      Component: Component
    });
  }

  return state.cacheClasses.value;
}

function $a1bd9a7fd5616071822dbc2f8a$var$attach(_ref2, props) {
  var state = _ref2.state,
      theme = _ref2.theme,
      stylesOptions = _ref2.stylesOptions,
      stylesCreator = _ref2.stylesCreator,
      name = _ref2.name;

  if (stylesOptions.disableGeneration) {
    return;
  }

  var sheetManager = $a1bd9a7fd5616071822dbc2f8a$import$multiKeyStore.get(stylesOptions.sheetsManager, stylesCreator, theme);

  if (!sheetManager) {
    sheetManager = {
      refs: 0,
      staticSheet: null,
      dynamicStyles: null
    };
    $a1bd9a7fd5616071822dbc2f8a$import$multiKeyStore.set(stylesOptions.sheetsManager, stylesCreator, theme, sheetManager);
  }

  var options = $a1bd9a7fd5616071822dbc2f8a$import$_extends({}, stylesCreator.options, {}, stylesOptions, {
    theme: theme,
    flip: typeof stylesOptions.flip === 'boolean' ? stylesOptions.flip : theme.direction === 'rtl'
  });
  options.generateId = options.serverGenerateClassName || options.generateClassName;
  var sheetsRegistry = stylesOptions.sheetsRegistry;

  if (sheetManager.refs === 0) {
    var staticSheet;

    if (stylesOptions.sheetsCache) {
      staticSheet = $a1bd9a7fd5616071822dbc2f8a$import$multiKeyStore.get(stylesOptions.sheetsCache, stylesCreator, theme);
    }

    var styles = stylesCreator.create(theme, name);

    if (!staticSheet) {
      staticSheet = stylesOptions.jss.createStyleSheet(styles, $a1bd9a7fd5616071822dbc2f8a$import$_extends({
        link: false
      }, options));
      staticSheet.attach();

      if (stylesOptions.sheetsCache) {
        $a1bd9a7fd5616071822dbc2f8a$import$multiKeyStore.set(stylesOptions.sheetsCache, stylesCreator, theme, staticSheet);
      }
    }

    if (sheetsRegistry) {
      sheetsRegistry.add(staticSheet);
    }

    sheetManager.staticSheet = staticSheet;
    sheetManager.dynamicStyles = $a1bd9a7fd5616071822dbc2f8a$import$getDynamicStyles(styles);
  }

  if (sheetManager.dynamicStyles) {
    var dynamicSheet = stylesOptions.jss.createStyleSheet(sheetManager.dynamicStyles, $a1bd9a7fd5616071822dbc2f8a$import$_extends({
      link: true
    }, options));
    dynamicSheet.update(props).attach();
    state.dynamicSheet = dynamicSheet;
    state.classes = $a1bd9a7fd5616071822dbc2f8a$import$mergeClasses({
      baseClasses: sheetManager.staticSheet.classes,
      newClasses: dynamicSheet.classes
    });

    if (sheetsRegistry) {
      sheetsRegistry.add(dynamicSheet);
    }
  } else {
    state.classes = sheetManager.staticSheet.classes;
  }

  sheetManager.refs += 1;
}

function $a1bd9a7fd5616071822dbc2f8a$var$update(_ref3, props) {
  var state = _ref3.state;

  if (state.dynamicSheet) {
    state.dynamicSheet.update(props);
  }
}

function $a1bd9a7fd5616071822dbc2f8a$var$detach(_ref4) {
  var state = _ref4.state,
      theme = _ref4.theme,
      stylesOptions = _ref4.stylesOptions,
      stylesCreator = _ref4.stylesCreator;

  if (stylesOptions.disableGeneration) {
    return;
  }

  var sheetManager = $a1bd9a7fd5616071822dbc2f8a$import$multiKeyStore.get(stylesOptions.sheetsManager, stylesCreator, theme);
  sheetManager.refs -= 1;
  var sheetsRegistry = stylesOptions.sheetsRegistry;

  if (sheetManager.refs === 0) {
    $a1bd9a7fd5616071822dbc2f8a$import$multiKeyStore.delete(stylesOptions.sheetsManager, stylesCreator, theme);
    stylesOptions.jss.removeStyleSheet(sheetManager.staticSheet);

    if (sheetsRegistry) {
      sheetsRegistry.remove(sheetManager.staticSheet);
    }
  }

  if (state.dynamicSheet) {
    stylesOptions.jss.removeStyleSheet(state.dynamicSheet);

    if (sheetsRegistry) {
      sheetsRegistry.remove(state.dynamicSheet);
    }
  }
}

function $a1bd9a7fd5616071822dbc2f8a$var$useSynchronousEffect(func, values) {
  var key = $a1bd9a7fd5616071822dbc2f8a$import$React.useRef([]);
  var output; // Store "generation" key. Just returns a new object every time

  var currentKey = $a1bd9a7fd5616071822dbc2f8a$import$React.useMemo(function () {
    return {};
  }, values); // eslint-disable-line react-hooks/exhaustive-deps
  // "the first render", or "memo dropped the value"

  if (key.current !== currentKey) {
    key.current = currentKey;
    output = func();
  }

  $a1bd9a7fd5616071822dbc2f8a$import$React.useEffect(function () {
    return function () {
      if (output) {
        output();
      }
    };
  }, [currentKey] // eslint-disable-line react-hooks/exhaustive-deps
  );
}

function $a1bd9a7fd5616071822dbc2f8a$export$default(stylesOrCreator) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var name = options.name,
      classNamePrefixOption = options.classNamePrefix,
      Component = options.Component,
      _options$defaultTheme = options.defaultTheme,
      defaultTheme = _options$defaultTheme === void 0 ? $a1bd9a7fd5616071822dbc2f8a$import$noopTheme : _options$defaultTheme,
      stylesOptions2 = $a1bd9a7fd5616071822dbc2f8a$import$_objectWithoutProperties(options, ["name", "classNamePrefix", "Component", "defaultTheme"]);
  var stylesCreator = $a1bd9a7fd5616071822dbc2f8a$import$getStylesCreator(stylesOrCreator);
  var classNamePrefix = name || classNamePrefixOption || 'makeStyles';
  stylesCreator.options = {
    index: $a1bd9a7fd5616071822dbc2f8a$import$increment(),
    name: name,
    meta: classNamePrefix,
    classNamePrefix: classNamePrefix
  };
  return function () {
    var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    var theme = $a1bd9a7fd5616071822dbc2f8a$import$useTheme() || defaultTheme;
    var stylesOptions = $a1bd9a7fd5616071822dbc2f8a$import$_extends({}, $a1bd9a7fd5616071822dbc2f8a$import$React.useContext($a1bd9a7fd5616071822dbc2f8a$import$StylesContext), {}, stylesOptions2);
    var instance = $a1bd9a7fd5616071822dbc2f8a$import$React.useRef();
    var shouldUpdate = $a1bd9a7fd5616071822dbc2f8a$import$React.useRef();
    $a1bd9a7fd5616071822dbc2f8a$var$useSynchronousEffect(function () {
      var current = {
        name: name,
        state: {},
        stylesCreator: stylesCreator,
        stylesOptions: stylesOptions,
        theme: theme
      };
      $a1bd9a7fd5616071822dbc2f8a$var$attach(current, props);
      shouldUpdate.current = false;
      instance.current = current;
      return function () {
        $a1bd9a7fd5616071822dbc2f8a$var$detach(current);
      };
    }, [theme, stylesCreator]);
    $a1bd9a7fd5616071822dbc2f8a$import$React.useEffect(function () {
      if (shouldUpdate.current) {
        $a1bd9a7fd5616071822dbc2f8a$var$update(instance.current, props);
      }

      shouldUpdate.current = true;
    });
    return $a1bd9a7fd5616071822dbc2f8a$var$getClasses(instance.current, props.classes, Component);
  };
}

$a1bd9a7fd5616071822dbc2f8a$exports.default = $a1bd9a7fd5616071822dbc2f8a$export$default;